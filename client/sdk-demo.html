<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraFace ç®¡ç†ç³»çµ± (SDKç‰ˆæœ¬)</title>
</head>
<body>
    <div id="auraface-admin-container"></div>

    <script src="sdk/auraface-admin.js"></script>
    <script>
        // ç®¡ç†å“¡ä½¿ç”¨ç¯„ä¾‹
        const admin = new AuraFaceAdmin({
            container: '#auraface-admin-container',
            wsUrl: 'ws://localhost:7861',
            autoConnect: true,
            enableRegistration: true,
            enableStats: true,
            frameRate: 5,
            
            // å›èª¿å‡½æ•¸
            onConnected: function(event) {
                console.log('âœ… ç®¡ç†å“¡å·²é€£æ¥åˆ° AuraFace ä¼ºæœå™¨');
            },
            
            onDisconnected: function(event) {
                console.log('âŒ ç®¡ç†å“¡èˆ‡ AuraFace ä¼ºæœå™¨æ–·ç·š:', event.code);
                
                // å¯ä»¥æ·»åŠ ç®¡ç†å“¡å°ˆç”¨çš„æ–·ç·šè™•ç†é‚è¼¯
                if (event.code === 1011) {
                    console.log('âš ï¸ å¿ƒè·³è¶…æ™‚ï¼Œå˜—è©¦é‡é€£...');
                }
            },
            
            onFaceDetected: function(data) {
                console.log('ğŸ‘¤ ç®¡ç†å“¡æª¢æ¸¬åˆ°äººè‡‰:', data.faces.length);
                
                // ç®¡ç†å“¡å¯ä»¥çœ‹åˆ°æ›´è©³ç´°çš„è³‡è¨Š
                data.faces.forEach((face, index) => {
                    if (face.person_id !== 'unknown') {
                        console.log(`[${index + 1}] ${face.name} (${face.role})`);
                        console.log(`    éƒ¨é–€: ${face.department || 'æœªè¨­å®š'}`);
                        console.log(`    ä¿¡å¿ƒåº¦: ${face.confidence.toFixed(4)}`);
                        console.log(`    é‚Šç•Œæ¡†: [${face.bbox.map(x => x.toFixed(1)).join(', ')}]`);
                    } else {
                        console.log(`[${index + 1}] æœªçŸ¥äººå“¡ - éœ€è¦è¨»å†Š`);
                    }
                });
            },
            
            onRegistrationComplete: function(data) {
                if (data.success) {
                    console.log('âœ… è¨»å†ŠæˆåŠŸ:', data.message);
                    
                    // è‡ªå‹•æ›´æ–°çµ±è¨ˆ
                    setTimeout(() => {
                        admin.requestStats();
                    }, 1000);
                } else {
                    console.log('âŒ è¨»å†Šå¤±æ•—:', data.message);
                }
            },
            
            onError: function(error) {
                console.error('âŒ AuraFace ç®¡ç†ç³»çµ±éŒ¯èª¤:', error);
                
                // ç®¡ç†å“¡å°ˆç”¨éŒ¯èª¤è™•ç†
                if (error.message.includes('WebSocket')) {
                    console.log('ğŸ”§ å»ºè­°æª¢æŸ¥ä¼ºæœå™¨é€£æ¥ç‹€æ…‹');
                } else if (error.message.includes('camera')) {
                    console.log('ğŸ“· å»ºè­°æª¢æŸ¥æ”åƒé ­æ¬Šé™');
                }
            }
        });

        // ç®¡ç†å“¡å°ˆç”¨å¿«æ·éµ
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch(event.key) {
                    case 'r':
                        // Ctrl+R: é‡æ–°é€£æ¥
                        event.preventDefault();
                        admin.disconnect();
                        setTimeout(() => admin.connect(), 1000);
                        console.log('ğŸ”„ é‡æ–°é€£æ¥ä¸­...');
                        break;
                    case 's':
                        // Ctrl+S: ç²å–çµ±è¨ˆè³‡æ–™
                        event.preventDefault();
                        console.log('ğŸ“Š çµ±è¨ˆè³‡æ–™:', admin.getGlobalStats());
                        break;
                    case 'f':
                        // Ctrl+F: ç²å–ç•¶å‰äººè‡‰è©³ç´°è³‡è¨Š
                        event.preventDefault();
                        const faces = admin.getCurrentFaces();
                        console.table(faces.map(face => ({
                            å§“å: face.name || 'æœªçŸ¥',
                            èº«åˆ†: face.role || 'æœªçŸ¥',
                            éƒ¨é–€: face.department || 'æœªè¨­å®š',
                            ä¿¡å¿ƒåº¦: face.confidence ? face.confidence.toFixed(4) : 'N/A',
                            äººè‡‰ID: face.person_id
                        })));
                        break;
                }
            }
        });

        // ç®¡ç†å“¡å„€è¡¨æ¿è³‡è¨Š
        console.log(`
ğŸ”§ AuraFace ç®¡ç†ç³»çµ±å¿«æ·éµï¼š
- Ctrl+Rï¼šé‡æ–°é€£æ¥ä¼ºæœå™¨
- Ctrl+Sï¼šæŸ¥çœ‹çµ±è¨ˆè³‡æ–™
- Ctrl+Fï¼šæŸ¥çœ‹ç•¶å‰äººè‡‰è©³ç´°è³‡è¨Š

ğŸ“Š ç®¡ç†åŠŸèƒ½ï¼š
- äººè‡‰è¨»å†Šï¼šæ”¯æ´å¤šäººå ´æ™¯è‡ªå‹•é¸æ“‡
- å³æ™‚çµ±è¨ˆï¼šç´¯è¨ˆè­˜åˆ¥æ•¸æ“š
- é€£æ¥ç›£æ§ï¼šè‡ªå‹•é‡é€£æ©Ÿåˆ¶
- è©³ç´°æ—¥èªŒï¼šå®Œæ•´çš„æ“ä½œè¨˜éŒ„
        `);

        // å®šæœŸé¡¯ç¤ºç³»çµ±ç‹€æ…‹ï¼ˆåƒ…é–‹ç™¼æ™‚ä½¿ç”¨ï¼‰
        if (location.hostname === 'localhost') {
            setInterval(() => {
                const status = admin.getConnectionStatus();
                const faces = admin.getCurrentFaces();
                const stats = admin.getGlobalStats();
                
                console.log(`[${new Date().toLocaleTimeString()}] ç‹€æ…‹: ${
                    status === WebSocket.OPEN ? 'å·²é€£æ¥' : 'æœªé€£æ¥'
                }, ç•¶å‰äººè‡‰: ${faces.length}, ç¸½è™•ç†å¹€æ•¸: ${stats.total_frames}`);
            }, 30000); // æ¯30ç§’
        }
    </script>
</body>
</html>